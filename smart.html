<!--
Smart Diaper Monitor - single-file demo
Instructions:
1) Create a Firebase Realtime Database project (or use your own backend). If using Firebase:
   - Go to Firebase Console -> Add project -> Realtime Database -> Create database (Start in test mode for dev).
   - In Project Settings -> SDK config, copy the firebaseConfig object values and paste into the firebaseConfig placeholder below.
2) Save this file as smart-diaper-monitor.html and open in a browser.
3) For quick local testing you can use the "Mock: Toggle Wet/Dry" button which simulates database updates.
4) When ready, connect your ESP32/ESP8266 to update the Realtime DB key /diaperStatus with values "Wet" or "Dry" and optionally write timestamps to /history.

What this file contains:
- Simple aesthetic interface similar to the provided image (baby icon, big status bar, green header)
- Real-time listener to Firebase Realtime Database (/diaperStatus and /history)
- Mock button for local testing
- Lightweight history display
-->

<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Smart Diaper Monitor</title>
  <style>
    :root{
      --bg:#f5f7fb;
      --card:#ffffff;
      --accent:#28a745; /* green */
      --accent-dark:#1f7a36;
      --primary:#2185d0; /* blue */
      --danger:#e74c3c;
      --muted:#6b7280;
      --radius:14px;
      font-family: Inter, system-ui, -apple-system, 'Segoe UI', Roboto, 'Helvetica Neue', Arial;
    }
    html,body{height:100%;margin:0;background:linear-gradient(180deg,#eef6ff 0%,var(--bg) 100%);}
    .wrap{min-height:100%;display:flex;align-items:center;justify-content:center;padding:32px}

    .card{
      width:360px;max-width:96%;background:var(--card);border-radius:18px;box-shadow:0 8px 30px rgba(18,38,63,0.08);overflow:hidden;
    }
    .header{background:linear-gradient(90deg,var(--accent) 0%, #57c785 100%);padding:14px 18px;color:#fff;display:flex;align-items:center;justify-content:space-between}
    .header .title{font-weight:700;font-size:16px}
    .header .small{font-weight:600;font-size:12px;opacity:0.95}

    .body{padding:22px;text-align:center}
    .baby-illustration{width:120px;height:120px;margin:0 auto 8px;display:flex;align-items:center;justify-content:center}
    .baby-illustration img{max-width:100%;height:auto}

    .status-pill{margin:14px auto;padding:14px;border-radius:12px;font-size:20px;font-weight:700;display:inline-block;min-width:240px}
    .status-dry{background:linear-gradient(90deg,#dff5e6,#e9fff0);color:var(--accent-dark);border:1px solid rgba(31,122,54,0.06)}
    .status-wet{background:linear-gradient(90deg,#ffecec,#fff0f0);color:var(--danger);border:1px solid rgba(231,76,60,0.06)}

    .meta{color:var(--muted);font-size:13px;margin-top:6px}

    .controls{display:flex;gap:10px;justify-content:center;margin-top:18px}
    .btn{padding:10px 14px;border-radius:10px;border:0;font-weight:700;cursor:pointer}
    .btn-primary{background:var(--primary);color:white}
    .btn-ghost{background:transparent;border:1px solid #e6e9ef;color:var(--muted)}

    .history{margin-top:18px;text-align:left;padding:12px;border-radius:12px;background:#fbfbfd;border:1px solid #f1f4fa;max-height:160px;overflow:auto}
    .history h4{margin:0 0 8px 0;font-size:13px;color:var(--muted)}
    .history ul{list-style:none;padding:0;margin:0}
    .history li{padding:8px 6px;border-bottom:1px dashed #eef2f7;font-size:13px}

    /* responsive */
    @media (max-width:420px){ .card{width:94%} }

  </style>
</head>
<body>
  <div class="wrap">
    <div class="card" role="main">
      <div class="header">
        <div class="title">Smart Diaper Monitor</div>
        <div class="small">Baby — Room A</div>
      </div>

      <div class="body">
        <div class="baby-illustration">
          <!-- simple inline SVG baby icon to match image feel -->
          <svg width="110" height="110" viewBox="0 0 64 64" xmlns="http://www.w3.org/2000/svg" aria-hidden="true">
            <circle cx="32" cy="24" r="12" fill="#ffd7b5" />
            <path d="M18 46c0-7.5 6-14 14-14s14 6.5 14 14v4H18v-4z" fill="#ffe9d6"/>
            <circle cx="27" cy="22" r="1.6" fill="#5b3b2a"/>
            <circle cx="37" cy="22" r="1.6" fill="#5b3b2a"/>
            <path d="M26 28c2 2 10 2 12 0" stroke="#5b3b2a" stroke-width="1" stroke-linecap="round" fill="none"/>
          </svg>
        </div>

        <div id="statusPill" class="status-pill status-dry">Loading...</div>
        <div id="meta" class="meta">Last updated: --</div>

        <div class="controls">
          <button id="mockBtn" class="btn btn-ghost">Mock: Toggle Wet/Dry</button>
          <button id="refreshBtn" class="btn btn-primary">Refresh</button>
        </div>

        <div class="history" aria-live="polite">
          <h4>History</h4>
          <ul id="historyList"><li>No history yet.</li></ul>
        </div>
      </div>
    </div>
  </div>

  <!-- Firebase v8 (compat) for simple real-time demo -->
  <script src="https://www.gstatic.com/firebasejs/8.6.8/firebase-app.js"></script>
  <script src="https://www.gstatic.com/firebasejs/8.6.8/firebase-database.js"></script>

  <script>
    /***** CONFIGURE THIS (Firebase) *****/
    const firebaseConfig = {
      apiKey: "YOUR_API_KEY",
      authDomain: "YOUR_AUTH_DOMAIN",
      databaseURL: "https://YOUR_PROJECT_ID.firebaseio.com",
      projectId: "YOUR_PROJECT_ID",
      storageBucket: "YOUR_PROJECT_ID.appspot.com",
      messagingSenderId: "SENDER_ID",
      appId: "APP_ID"
    };
    /***** END CONFIG *****/

    // Initialize Firebase (wrapped so file still loads even if config not changed)
    let firebaseReady = false;
    try{
      firebase.initializeApp(firebaseConfig);
      firebaseReady = true;
    } catch(e){
      console.warn('Firebase not initialized — configure firebaseConfig to enable real-time updates. Using mock mode.');
    }

    const statusPill = document.getElementById('statusPill');
    const meta = document.getElementById('meta');
    const historyList = document.getElementById('historyList');
    const mockBtn = document.getElementById('mockBtn');
    const refreshBtn = document.getElementById('refreshBtn');

    let currentStatus = null;

    function setUI(status, timestamp){
      currentStatus = status;
      const tsText = timestamp ? new Date(timestamp).toLocaleString() : new Date().toLocaleString();
      meta.textContent = 'Last updated: ' + tsText;
      if(status === 'Wet'){
        statusPill.textContent = 'Wet — Change Diaper!';
        statusPill.className = 'status-pill status-wet';
      } else if(status === 'Dry'){
        statusPill.textContent = 'Dry';
        statusPill.className = 'status-pill status-dry';
      } else {
        statusPill.textContent = status || 'Unknown';
        statusPill.className = 'status-pill';
      }
    }

    function prependHistoryItem(text){
      const li = document.createElement('li');
      li.textContent = text;
      if(historyList.children.length === 1 && historyList.children[0].textContent === 'No history yet.'){
        historyList.innerHTML = '';
      }
      historyList.insertBefore(li, historyList.firstChild);
      // keep max 20
      while(historyList.children.length > 20) historyList.removeChild(historyList.lastChild);
    }

    // If firebase configured, listen to real-time updates
    if(firebaseReady){
      const db = firebase.database();
      const statusRef = db.ref('/diaperStatus');
      const historyRef = db.ref('/history');

      statusRef.on('value', snapshot => {
        const val = snapshot.val();
        // val can be object {state:"Wet",ts:163...} or simple string like "Wet"
        let state = null, ts = null;
        if(val && typeof val === 'object' && val.state){ state = val.state; ts = val.ts; }
        else if(typeof val === 'string') state = val;
        setUI(state, ts);
      });

      // read last 20 history
      historyRef.limitToLast(20).on('value', snap => {
        const v = snap.val();
        historyList.innerHTML = '';
        if(!v){ historyList.innerHTML = '<li>No history yet.</li>'; return; }
        // v is an object of keyed entries
        const items = Object.values(v).reverse(); // newest first
        items.forEach(it => {
          const text = (it.state ? it.state + ' — ' : '') + (it.ts ? new Date(it.ts).toLocaleString() : it);
          const li = document.createElement('li'); li.textContent = text; historyList.appendChild(li);
        });
      });

      // Button: Refresh (reads one-time)
      refreshBtn.addEventListener('click', () => {
        statusRef.once('value').then(snap=>{
          const v = snap.val();
          let state = null, ts = null;
          if(v && typeof v === 'object' && v.state){ state = v.state; ts = v.ts; }
          else if(typeof v === 'string') state = v;
          setUI(state, ts);
        });
      });

    } else {
      // Mock-only mode: wire refresh to just update timestamp
      refreshBtn.addEventListener('click', ()=> setUI(currentStatus || 'Dry'));
    }

    // Mock button toggles local and (if firebase) writes simulated values
    mockBtn.addEventListener('click', async ()=>{
      const newState = (currentStatus === 'Wet') ? 'Dry' : 'Wet';
      const ts = Date.now();
      setUI(newState, ts);
      prependHistoryItem(newState + ' — ' + new Date(ts).toLocaleString());

      if(firebaseReady){
        try{
          const db = firebase.database();
          // Write both /diaperStatus and push to /history
          await db.ref('/diaperStatus').set({ state: newState, ts });
          await db.ref('/history').push({ state: newState, ts });
        }catch(err){console.error('firebase write failed',err)}
      }
    });

    // initialize UI default
    setUI('Dry');

  </script>
</body>
</html>
